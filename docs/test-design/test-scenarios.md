# テストシナリオ
## ShopTodo E2Eテスト練習用アプリケーション

---

### 文書情報
- **文書ID**: TS-002
- **版数**: 1.0
- **作成日**: 2025-09-21
- **作成者**: Claude Code
- **承認者**: Test Manager
- **最終更新**: 2025-09-21
- **関連文書**: ユーザーストーリー(US-001), テスト戦略書(TS-001)

---

## 1. テストシナリオ概要

### 1.1 目的
ユーザーストーリーに基づいて、実際のユーザー操作を模擬した統合的なテストシナリオを定義し、E2Eテストの設計基盤を提供する。

### 1.2 シナリオ分類
- **ハッピーパスシナリオ**: 正常な操作フローでの成功シナリオ
- **代替パスシナリオ**: 例外的な操作やエラーケースのシナリオ
- **エッジケースシナリオ**: 境界値や特殊条件でのシナリオ
- **統合シナリオ**: 複数機能を組み合わせた複合的なシナリオ

### 1.3 シナリオ記述形式
各シナリオはGherkin記法（Given-When-Then）で記述し、自動化テストの実装を支援する。

---

## 2. 認証機能テストシナリオ

### 2.1 ログイン機能シナリオ

#### TS-AUTH-001: 正常ログイン（ハッピーパス）
```gherkin
Feature: ユーザーログイン
  As a テスト学習者
  I want to デモ認証でログインできる
  So that 認証機能のテスト方法を学習できる

Scenario: 有効な認証情報でのログイン
  Given ユーザーがログインページにいる
  And ログインフォームが表示されている
  When ユーザー名フィールドに "demo" を入力する
  And パスワードフィールドに "password" を入力する
  And "ログイン" ボタンをクリックする
  Then ダッシュボードページに遷移する
  And ユーザー名 "demo" がヘッダーに表示される
  And ログイン状態がlocalStorageに保存される
```

#### TS-AUTH-002: 無効な認証情報でのログイン（代替パス）
```gherkin
Scenario: 無効なユーザー名でのログイン試行
  Given ユーザーがログインページにいる
  When ユーザー名フィールドに "invalid" を入力する
  And パスワードフィールドに "password" を入力する
  And "ログイン" ボタンをクリックする
  Then エラーメッセージ "無効な認証情報です" が表示される
  And ログインページに留まる
  And localStorage にログイン情報が保存されない
```

#### TS-AUTH-003: 空フィールドでのログイン試行（エッジケース）
```gherkin
Scenario Outline: 必須フィールドが空の場合
  Given ユーザーがログインページにいる
  When ユーザー名フィールドに "<username>" を入力する
  And パスワードフィールドに "<password>" を入力する
  And "ログイン" ボタンをクリックする
  Then エラーメッセージ "<error_message>" が表示される

  Examples:
    | username | password | error_message |
    |          | password | ユーザー名を入力してください |
    | demo     |          | パスワードを入力してください |
    |          |          | ユーザー名とパスワードを入力してください |
```

### 2.2 ログアウト機能シナリオ

#### TS-AUTH-004: 正常ログアウト（ハッピーパス）
```gherkin
Scenario: ログイン状態からのログアウト
  Given ユーザーが "demo" でログインしている
  And ダッシュボードページにいる
  When ヘッダーの "ログアウト" ボタンをクリックする
  Then ログインページに遷移する
  And localStorage からログイン情報が削除される
  And ヘッダーにユーザー名が表示されない
```

### 2.3 セッション管理シナリオ

#### TS-AUTH-005: ページリロード後の状態復元（統合シナリオ）
```gherkin
Scenario: ログイン状態の永続化確認
  Given ユーザーが "demo" でログインしている
  And ダッシュボードページにいる
  When ページをリロードする
  Then ログイン状態が維持されている
  And ユーザー名 "demo" がヘッダーに表示される
  And ダッシュボードページが表示されている
```

---

## 3. 商品カタログ機能テストシナリオ

### 3.1 商品一覧表示シナリオ

#### TS-CATALOG-001: 初期商品一覧表示（ハッピーパス）
```gherkin
Feature: 商品カタログ機能
  As a 一般利用者
  I want to 商品一覧を閲覧できる
  So that 購入したい商品を探すことができる

Scenario: 商品一覧の初期表示
  Given ユーザーがログインしている
  When ダッシュボードページを表示する
  Then 12個の商品が表示される
  And 各商品に以下の情報が表示される:
    | 商品名 |
    | 価格 |
    | カテゴリ |
    | 商品画像プレースホルダー |
  And "カートに追加" ボタンが各商品に表示される
```

### 3.2 商品検索シナリオ

#### TS-CATALOG-002: 商品名での検索（ハッピーパス）
```gherkin
Scenario: 部分一致での商品検索
  Given ユーザーがダッシュボードページにいる
  And 12個の商品が表示されている
  When 検索ボックスに "スマート" を入力する
  Then 「スマートフォン」を含む商品のみが表示される
  And 他の商品は表示されない
  And 検索結果件数が表示される
```

#### TS-CATALOG-003: 多言語検索（統合シナリオ）
```gherkin
Scenario: 英語モードでの商品検索
  Given ユーザーがダッシュボードページにいる
  And 言語設定が英語になっている
  When 検索ボックスに "Smart" を入力する
  Then 「Smartphone」を含む商品のみが表示される
  And 商品名が英語で表示される
```

#### TS-CATALOG-004: 検索結果なし（代替パス）
```gherkin
Scenario: 該当商品がない検索
  Given ユーザーがダッシュボードページにいる
  When 検索ボックスに "存在しない商品" を入力する
  Then "検索結果が見つかりませんでした" というメッセージが表示される
  And 商品一覧が空になる
  And 検索結果件数が "0件" と表示される
```

### 3.3 カテゴリフィルタシナリオ

#### TS-CATALOG-005: 単一カテゴリフィルタ（ハッピーパス）
```gherkin
Scenario: エレクトロニクスカテゴリでのフィルタ
  Given ユーザーがダッシュボードページにいる
  When "electronics" カテゴリを選択する
  Then エレクトロニクス商品のみが表示される:
    | スマートフォン |
    | ノートパソコン |
    | ワイヤレスイヤホン |
  And 他のカテゴリの商品は表示されない
```

#### TS-CATALOG-006: 複数カテゴリフィルタ（エッジケース）
```gherkin
Scenario: 複数カテゴリの同時選択
  Given ユーザーがダッシュボードページにいる
  When "electronics" カテゴリを選択する
  And "books" カテゴリも選択する
  Then エレクトロニクス商品とブック商品が表示される
  And 他のカテゴリの商品は表示されない
  And 選択されたカテゴリが視覚的にハイライトされる
```

### 3.4 ソート機能シナリオ

#### TS-CATALOG-007: 価格ソート（ハッピーパス）
```gherkin
Scenario: 価格昇順でのソート
  Given ユーザーがダッシュボードページにいる
  When ソートオプションで "価格（安い順）" を選択する
  Then 商品が価格の安い順に並び替えられる
  And 最初の商品が最も安い商品になる
  And 最後の商品が最も高い商品になる
```

#### TS-CATALOG-008: 検索とソートの組み合わせ（統合シナリオ）
```gherkin
Scenario: 検索結果のソート
  Given ユーザーがダッシュボードページにいる
  When 検索ボックスに "本" を入力する
  And ソートオプションで "価格（高い順）" を選択する
  Then 検索でヒットした本の商品が価格の高い順に表示される
  And 検索フィルタとソートが同時に適用される
```

---

## 4. ショッピングカート機能テストシナリオ

### 4.1 カート追加シナリオ

#### TS-CART-001: 商品のカート追加（ハッピーパス）
```gherkin
Feature: ショッピングカート機能
  As a 一般利用者
  I want to 商品をカートに追加できる
  So that 後でまとめて購入できる

Scenario: 初回商品追加
  Given ユーザーがダッシュボードページにいる
  And カートが空の状態である
  When "スマートフォン" の "カートに追加" ボタンをクリックする
  Then カート内商品数が "1" に更新される
  And カートアイコンに商品数バッジが表示される
  And 「商品をカートに追加しました」というメッセージが表示される
```

#### TS-CART-002: 同一商品の重複追加（エッジケース）
```gherkin
Scenario: 同じ商品の複数回追加
  Given カートに "スマートフォン" が1個入っている
  When 再度 "スマートフォン" の "カートに追加" ボタンをクリックする
  Then カート内の "スマートフォン" の数量が "2" になる
  And カート内商品数が "2" に更新される
  And 合計金額が正しく計算される
```

### 4.2 カート管理シナリオ

#### TS-CART-003: カート内容表示（ハッピーパス）
```gherkin
Scenario: カート詳細表示
  Given カートに以下の商品が入っている:
    | 商品名 | 数量 | 価格 |
    | スマートフォン | 1 | 89,800 |
    | ノートパソコン | 2 | 129,800 |
  When カートページを表示する
  Then 以下の情報が表示される:
    | 商品一覧 |
    | 各商品の数量 |
    | 各商品の小計 |
    | 合計金額: 349,400円 |
```

#### TS-CART-004: 商品数量変更（ハッピーパス）
```gherkin
Scenario: カート内商品数量の増加
  Given カートに "スマートフォン" が1個入っている
  And カートページを表示している
  When "スマートフォン" の数量を "3" に変更する
  Then 商品数量が "3" に更新される
  And 小計が "269,400円" に更新される
  And カート内商品数が "3" に更新される
```

#### TS-CART-005: 商品削除（代替パス）
```gherkin
Scenario: カートからの商品削除
  Given カートに複数の商品が入っている
  When "スマートフォン" の "削除" ボタンをクリックする
  Then "スマートフォン" がカートから削除される
  And カート内商品数が減少する
  And 合計金額が再計算される
```

### 4.3 チェックアウトシナリオ

#### TS-CART-006: 正常チェックアウト（ハッピーパス）
```gherkin
Scenario: 購入手続き完了
  Given カートに商品が入っている
  And カートページを表示している
  When "チェックアウト" ボタンをクリックする
  Then 購入確認ダイアログが表示される
  When 購入確認ダイアログで "確認" をクリックする
  Then "購入が完了しました" というメッセージが表示される
  And カートが空になる
  And 購入履歴がlocalStorageに保存される
```

#### TS-CART-007: 空カートでのチェックアウト（エッジケース）
```gherkin
Scenario: 空カートでの購入試行
  Given カートが空の状態である
  When チェックアウトページにアクセスする
  Then "カートが空です" というメッセージが表示される
  And "チェックアウト" ボタンが無効化されている
  And "商品を追加してください" という案内が表示される
```

---

## 5. ToDoリスト機能テストシナリオ

### 5.1 ToDo追加シナリオ

#### TS-TODO-001: お気に入り商品メモ追加（ハッピーパス）
```gherkin
Feature: ToDoリスト機能
  As a 一般利用者
  I want to お気に入り商品をメモできる
  So that 後で商品を確認できる

Scenario: 新規ToDoアイテム追加
  Given ユーザーがダッシュボードページにいる
  And ToDoリストが表示されている
  When ToDoテキストボックスに "ワイヤレスイヤホンを検討" を入力する
  And "追加" ボタンをクリックする
  Then 新しいToDoアイテムがリストに追加される
  And アイテムが未完了状態で表示される
  And テキストボックスがクリアされる
```

### 5.2 ToDo管理シナリオ

#### TS-TODO-002: 完了状態切り替え（ハッピーパス）
```gherkin
Scenario: ToDoアイテムの完了マーク
  Given ToDoリストに "ワイヤレスイヤホンを検討" が未完了で存在する
  When アイテムのチェックボックスをクリックする
  Then アイテムが完了状態に変更される
  And テキストに取り消し線が表示される
  And チェックボックスにチェックマークが表示される
```

#### TS-TODO-003: ToDoアイテム削除（代替パス）
```gherkin
Scenario: 不要なToDoアイテムの削除
  Given ToDoリストに複数のアイテムが存在する
  When "ワイヤレスイヤホンを検討" の "削除" ボタンをクリックする
  Then 該当アイテムがリストから削除される
  And 他のアイテムは残る
  And ToDoデータがlocalStorageから削除される
```

---

## 6. 言語切り替え機能テストシナリオ

### 6.1 言語切り替えシナリオ

#### TS-LANG-001: 日本語から英語への切り替え（ハッピーパス）
```gherkin
Feature: 多言語対応機能
  As a 国際的利用者
  I want to 言語を切り替えられる
  So that 母国語でアプリケーションを利用できる

Scenario: 英語への言語切り替え
  Given アプリケーションが日本語で表示されている
  And ヘッダーに "JP" と "EN" ボタンが表示されている
  When "EN" ボタンをクリックする
  Then 全てのUI要素が英語で表示される
  And 商品名が英語版で表示される
  And ヘッダーの "EN" ボタンがアクティブ状態になる
  And 言語設定がlocalStorageに保存される
```

#### TS-LANG-002: 言語設定の永続化（統合シナリオ）
```gherkin
Scenario: 言語設定の永続化確認
  Given アプリケーションが英語で表示されている
  When ページをリロードする
  Then アプリケーションが英語のまま表示される
  And 商品名も英語版が維持される
  And "EN" ボタンがアクティブ状態のまま
```

### 6.2 翻訳データ完全性シナリオ

#### TS-LANG-003: 翻訳データ完全性確認（エッジケース）
```gherkin
Scenario: 全ページでの翻訳確認
  Given アプリケーションが日本語で表示されている
  When 各ページを順次表示する:
    | ログインページ |
    | ダッシュボード |
    | カートページ |
  And 各ページで "EN" ボタンをクリックする
  Then 全てのテキストが英語で表示される
  And 未翻訳項目が存在しない
  And レイアウトの崩れがない
```

---

## 7. データ永続化機能テストシナリオ

### 7.1 状態保存シナリオ

#### TS-PERSIST-001: 複合状態の永続化（統合シナリオ）
```gherkin
Feature: データ永続化機能
  As a 一般利用者
  I want to アプリケーションの状態が保存される
  So that 次回利用時にデータが復元される

Scenario: 複数状態の同時保存・復元
  Given ユーザーが "demo" でログインしている
  And カートに "スマートフォン" が2個入っている
  And ToDoリストに "ワイヤレスイヤホンを検討" が存在する
  And 言語設定が英語になっている
  When ブラウザを閉じて再起動する
  And アプリケーションにアクセスする
  Then ログイン状態が復元される
  And カート内容が復元される:
    | スマートフォン | 2個 |
  And ToDoリスト内容が復元される:
    | ワイヤレスイヤホンを検討 |
  And 言語設定（英語）が復元される
```

### 7.2 ブラウザ互換性シナリオ

#### TS-PERSIST-002: クロスブラウザ対応確認（非機能シナリオ）
```gherkin
Scenario Outline: 異なるブラウザでのデータ永続化
  Given ユーザーが "<browser>" を使用している
  And アプリケーションにアクセスしている
  When ログインしてカートに商品を追加する
  And ブラウザを再起動する
  Then データが正常に復元される

  Examples:
    | browser |
    | Chrome |
    | Firefox |
    | Safari |
    | Edge |
```

---

## 8. エラーハンドリングシナリオ

### 8.1 ネットワークエラーシナリオ

#### TS-ERROR-001: ネットワーク切断時の動作（代替パス）
```gherkin
Feature: エラーハンドリング
  As a 一般利用者
  I want to エラーが適切に処理される
  So that 予期しない動作を避けることができる

Scenario: ネットワーク切断状態での操作
  Given ユーザーがアプリケーションを使用している
  And ネットワーク接続が切断された
  When 何らかの操作を実行する
  Then オフライン用の適切なメッセージが表示される
  And 既存のデータは保持される
  And ネットワーク復旧後に同期される
```

### 8.2 データ破損エラーシナリオ

#### TS-ERROR-002: localStorage破損時の対応（エッジケース）
```gherkin
Scenario: 不正なlocalStorageデータの処理
  Given localStorageに不正なデータが存在する
  When アプリケーションを開始する
  Then エラーが発生せずに初期状態で開始される
  And 不正なデータがクリアされる
  And 正常な初期データが設定される
```

---

## 9. パフォーマンステストシナリオ

### 9.1 レスポンシブデザインシナリオ

#### TS-PERF-001: 異なる画面サイズでの動作（非機能シナリオ）
```gherkin
Feature: レスポンシブデザイン
  As a モバイル利用者
  I want to スマートフォンやタブレットで快適に利用できる
  So that デバイスを問わずショッピングを楽しめる

Scenario Outline: 異なる画面サイズでの表示確認
  Given ブラウザのサイズが "<width>x<height>" に設定されている
  When ダッシュボードページを表示する
  Then レイアウトが適切に調整される
  And 全ての要素が表示される
  And 操作が可能である

  Examples:
    | width | height | device_type |
    | 375 | 667 | Mobile |
    | 768 | 1024 | Tablet |
    | 1024 | 768 | Desktop |
    | 1920 | 1080 | Large Desktop |
```

### 9.2 パフォーマンスシナリオ

#### TS-PERF-002: 初期読み込み時間（非機能シナリオ）
```gherkin
Scenario: アプリケーション初期読み込み性能
  Given ユーザーがアプリケーションURLにアクセスする
  When ページの読み込みが開始される
  Then 3秒以内に初期画面が表示される
  And 5秒以内に全ての機能が利用可能になる
  And 読み込み中の適切なローディング表示がある
```

---

## 10. セキュリティテストシナリオ

### 10.1 入力値検証シナリオ

#### TS-SEC-001: XSS攻撃防止（セキュリティシナリオ）
```gherkin
Feature: セキュリティ対策
  As a セキュリティ意識の高い利用者
  I want to 安全にアプリケーションを利用できる
  So that 個人情報が保護される

Scenario: スクリプト注入攻撃の防止
  Given ユーザーがToDoリスト機能を使用している
  When テキストボックスに "<script>alert('XSS')</script>" を入力する
  And "追加" ボタンをクリックする
  Then スクリプトが実行されない
  And テキストがそのまま表示される
  And XSSアラートが表示されない
```

---

## 11. 統合テストシナリオ

### 11.1 完全ユーザージャーニーシナリオ

#### TS-INTEGRATION-001: 新規ユーザーの完全フロー（統合シナリオ）
```gherkin
Feature: エンドツーエンドユーザージャーニー
  As a 新規利用者
  I want to アプリケーションの全機能を体験できる
  So that 完全なショッピング体験を得ることができる

Scenario: 新規ユーザーの完全ショッピングフロー
  Given ユーザーがアプリケーションに初回アクセスする

  # 言語選択
  When "EN" ボタンをクリックして英語に切り替える
  Then 全てのUI要素が英語で表示される

  # ログイン
  When ユーザー名 "demo"、パスワード "password" でログインする
  Then ダッシュボードページに遷移する

  # 商品検索・フィルタ
  When 検索ボックスに "Smart" を入力する
  And "electronics" カテゴリを選択する
  Then "Smartphone" が検索結果に表示される

  # カート操作
  When "Smartphone" を2個カートに追加する
  And "Laptop" を1個カートに追加する
  Then カート内商品数が "3" になる

  # ToDo追加
  When ToDoリストに "Consider wireless earphones" を追加する
  Then ToDoアイテムが表示される

  # チェックアウト
  When カートページでチェックアウトを実行する
  Then 購入が完了する
  And カートが空になる

  # 状態確認
  When ページをリロードする
  Then ログイン状態が維持される
  And 言語設定（英語）が維持される
  And ToDoリストが維持される
  And 購入履歴が記録される
```

### 11.2 データ一貫性確認シナリオ

#### TS-INTEGRATION-002: 複数操作でのデータ一貫性（統合シナリオ）
```gherkin
Scenario: 複数操作でのデータ整合性確認
  Given ユーザーがログインしている

  # 並行操作シミュレーション
  When 以下の操作を順次実行する:
    | 商品 "A" をカートに追加 |
    | 言語を英語に切り替え |
    | 商品 "B" をカートに追加 |
    | ToDo "item1" を追加 |
    | 商品 "A" の数量を変更 |
    | ToDo "item1" を完了にマーク |

  Then 全ての操作が正常に完了する
  And カート内容が正確に反映される:
    | 商品A | 変更後数量 |
    | 商品B | 1個 |
  And ToDoリストが正確に反映される:
    | item1 | 完了状態 |
  And 言語設定が英語で維持される
  And 全てのデータがlocalStorageに正確に保存される
```

---

## 12. シナリオ実行優先度

### 12.1 優先度マトリックス

| 優先度 | シナリオタイプ | 実行タイミング | 自動化レベル |
|--------|---------------|---------------|-------------|
| P1 | ハッピーパス | 毎回 | 完全自動化 |
| P2 | 統合シナリオ | 毎回 | 完全自動化 |
| P3 | 代替パス | リリース前 | 半自動化 |
| P4 | エッジケース | リリース前 | 手動 |
| P5 | 非機能テスト | 週次 | 半自動化 |

### 12.2 実行戦略

#### 煙テスト（Smoke Test）
- TS-AUTH-001: 正常ログイン
- TS-CATALOG-001: 商品一覧表示
- TS-CART-001: カート追加
- TS-LANG-001: 言語切り替え

#### 回帰テスト（Regression Test）
- 全ハッピーパスシナリオ
- 主要統合シナリオ
- データ永続化シナリオ

#### 受入テスト（Acceptance Test）
- TS-INTEGRATION-001: 完全ユーザージャーニー
- TS-INTEGRATION-002: データ一貫性確認

---

## 13. テストデータ管理

### 13.1 テストデータセット

#### 商品データ
```json
{
  "products": [
    {"id": 1, "name_jp": "スマートフォン", "name_en": "Smartphone", "price": 89800, "category": "electronics"},
    {"id": 2, "name_jp": "ノートパソコン", "name_en": "Laptop", "price": 129800, "category": "electronics"}
  ]
}
```

#### ユーザーデータ
```json
{
  "users": [
    {"username": "demo", "password": "password", "role": "user"},
    {"username": "invalid", "password": "wrong", "role": "invalid"}
  ]
}
```

### 13.2 環境別データ管理
- **開発環境**: 固定テストデータ
- **テスト環境**: バリエーション豊富なデータ
- **本番環境**: 最小限のデモデータ

---

## 14. 改版履歴

| 版数 | 日付 | 変更内容 | 変更者 |
|------|------|----------|--------|
| 1.0 | 2025-09-21 | 初版作成 | Claude Code |

---

## 承認

| 役割 | 氏名 | 署名 | 日付 |
|------|------|------|------|
| テストアナリスト | [TBD] | [TBD] | [TBD] |
| テストマネージャー | [TBD] | [TBD] | [TBD] |
| 開発リーダー | [TBD] | [TBD] | [TBD] |