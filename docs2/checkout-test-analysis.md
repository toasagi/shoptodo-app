# チェックアウト機能テスト分析書

## 1. 文書情報

**文書ID**: TA-CHECKOUT-001
**バージョン**: 1.0
**作成日**: 2025年9月29日
**関連文書**: TP-CHECKOUT-001 (テスト計画書)

## 2. テスト条件の識別

### 2.1 機能分解

```
チェックアウト機能
├── チェックアウトモーダル
│   ├── ステップ1: 配送先情報
│   │   ├── 名前入力
│   │   ├── メールアドレス入力
│   │   ├── 電話番号入力
│   │   ├── 郵便番号入力
│   │   └── 住所入力
│   ├── ステップ2: 支払い方法
│   │   ├── クレジットカード選択
│   │   ├── 銀行振込選択
│   │   └── 代金引換選択
│   ├── ステップ3: 注文確認
│   │   ├── 商品リスト表示
│   │   ├── 配送先情報表示
│   │   ├── 支払い方法表示
│   │   └── 合計金額表示
│   └── ステップ4: 注文完了
│       ├── 注文番号表示
│       └── 完了メッセージ表示
└── 注文履歴
    ├── 注文リスト表示
    ├── 注文詳細表示
    └── 空の履歴表示
```

### 2.2 テスト条件マトリックス

| ID | テスト条件 | 優先度 | リスクレベル | テスト技法 |
|----|------------|--------|--------------|------------|
| TC01 | カートが空の状態でチェックアウト不可 | 高 | 中 | 状態遷移 |
| TC02 | 必須フィールドの検証 | 高 | 高 | 同値分割 |
| TC03 | メールアドレス形式の検証 | 高 | 中 | 境界値分析 |
| TC04 | 電話番号形式の検証 | 中 | 低 | 同値分割 |
| TC05 | ステップ間の前進・後退 | 高 | 中 | 状態遷移 |
| TC06 | 支払い方法の選択と保持 | 高 | 中 | 状態遷移 |
| TC07 | 注文データの永続化 | 高 | 高 | エラー推測 |
| TC08 | 注文履歴の時系列表示 | 中 | 低 | 順序検証 |
| TC09 | 多言語対応 | 中 | 低 | 国際化 |
| TC10 | レスポンシブデザイン | 中 | 中 | UI検証 |

## 3. テスト設計技法の適用

### 3.1 同値分割法

#### 配送先情報の入力値クラス

| フィールド | 有効同値クラス | 無効同値クラス |
|------------|----------------|----------------|
| 名前 | 1-100文字の文字列 | 空文字、101文字以上 |
| メール | 有効な形式 (xxx@xxx.xxx) | 無効な形式、空文字 |
| 電話番号 | 10-11桁の数字（ハイフンあり/なし） | 9桁以下、12桁以上、文字含む |
| 郵便番号 | 7桁（ハイフンあり/なし） | 6桁以下、8桁以上 |
| 住所 | 1-200文字の文字列 | 空文字、201文字以上 |

### 3.2 境界値分析

#### 文字数制限の境界値

| フィールド | 下限境界 | 上限境界 |
|------------|----------|----------|
| 名前 | 0, 1, 2 | 99, 100, 101 |
| 住所 | 0, 1, 2 | 199, 200, 201 |

### 3.3 状態遷移テスト

```
[初期状態] --> [ステップ1:配送先]
                    ↓ (次へ)
              [ステップ2:支払い]
                ↓ (戻る) ↓ (次へ)
              [ステップ3:確認]
                ↓ (戻る) ↓ (注文確定)
              [ステップ4:完了]
                    ↓ (OK)
              [モーダル閉じる]
```

**遷移条件:**
- 次へ: フォームバリデーション成功
- 戻る: 常に可能
- 注文確定: すべての情報が揃っている
- OK: 常に可能

### 3.4 エラー推測

**予測されるエラー:**
1. ブラウザの戻るボタン使用時の状態不整合
2. セッションタイムアウト時のデータ消失
3. 同時に複数タブで操作
4. ネットワーク切断時の動作
5. localStorageの容量超過

## 4. テストデータ要件

### 4.1 正常系テストデータ

```javascript
const validShippingData = {
  name: "山田太郎",
  email: "yamada@example.com",
  phone: "090-1234-5678",
  postalCode: "100-0001",
  address: "東京都千代田区千代田1-1"
};

const validCartItems = [
  { id: 1, name: "スマートフォン", price: 89800, quantity: 1 },
  { id: 3, name: "Tシャツ", price: 2980, quantity: 2 }
];
```

### 4.2 異常系テストデータ

```javascript
const invalidEmails = [
  "",                    // 空
  "notanemail",         // @なし
  "@example.com",       // ローカル部なし
  "user@",              // ドメインなし
  "user@.com",          // ドメイン名なし
  "user@example",       // TLDなし
];

const invalidPhones = [
  "",                    // 空
  "123456789",          // 9桁
  "123456789012",       // 12桁
  "abc-defg-hijk",      // 文字含む
  "090 1234 5678",      // スペース区切り
];
```

## 5. テスト環境要件

### 5.1 ブラウザマトリックス

| ブラウザ | バージョン | OS | 優先度 |
|----------|------------|-----|--------|
| Chrome | 最新版 | Windows, Mac, Linux | 高 |
| Firefox | 最新版 | Windows, Mac | 中 |
| Safari | 最新版 | Mac | 中 |
| Edge | 最新版 | Windows | 低 |

### 5.2 画面解像度

- Desktop: 1920x1080, 1366x768
- Tablet: 768x1024
- Mobile: 375x667, 360x640

## 6. テストカバレッジ目標

### 6.1 機能カバレッジ
- すべての入力フィールド: 100%
- すべてのボタン/リンク: 100%
- すべてのエラーメッセージ: 100%

### 6.2 コードカバレッジ
- ステートメントカバレッジ: 90%以上
- ブランチカバレッジ: 85%以上
- 関数カバレッジ: 95%以上

### 6.3 リスクベースカバレッジ
- 高リスク項目: 100%
- 中リスク項目: 80%
- 低リスク項目: 60%

## 7. テストケース優先順位付け

### 優先度レベル
1. **P0 (必須)**: システムの基本動作に関わる
2. **P1 (高)**: 主要機能の正常動作
3. **P2 (中)**: エッジケース、エラー処理
4. **P3 (低)**: UI/UXの細かい調整

### 優先順位マトリックス

| テストケースカテゴリ | 優先度 | 実行頻度 |
|----------------------|--------|----------|
| ハッピーパス | P0 | 毎回 |
| 必須フィールド検証 | P1 | 毎回 |
| エラーハンドリング | P2 | リグレッション時 |
| 多言語切り替え | P3 | リリース前 |

## 8. トレーサビリティ

要件からテストケースへのトレーサビリティは、checkout-test-cases.mdで管理される。